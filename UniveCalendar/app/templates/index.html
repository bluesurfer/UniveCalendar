{% extends 'base.html' %}
{% set active_page='home' %}


{% block styles %}
    {{ super() }}

    <link href="{{ url_for('static',filename='css/plugins/fullcalendar/fullcalendar.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='css/plugins/fullcalendar/fullcalendar.print.css') }}" rel='stylesheet' media='print'>

    <style>
    #map {
        height: 500px;
    }

    </style>

{% endblock %}


{% block content %}

    <div class="row">
        <div class="col-lg-8">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Il mio calendario</h5>

                </div>
                <div class="ibox-content">
                    {% if not current_user.courses.first() %}
                        <div class="alert alert-warning">
                            Il tuo calendario è vuoto. <a class="alert-link" href="{{ url_for('main.courses') }}">Aggiungi Corsi</a>.
                        </div>
                    {% endif %}
                    <div id="calendar"></div>
                    <hr>
                    <a href="{{ url_for('main.download_calendar') }}" class="btn btn-success btn-block m-t"><i class="fa fa-download"></i> Scarica Calendario</a>
                    <small>Scarica il tuo calendario in formato ICS compatibile con le più comuni applicazioni Calendar</small>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox ">
                        <div class="ibox-title">
                            <h5>Mappa</h5>
                        </div>
                        <div class="ibox-content">
                            <p>

                            </p>
                            <div class="google-map" id="map"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-lg-4">

            <div class="ibox">
                <div class="ibox-title">
                    <h5>Ultimi avvisi</h5>

                </div>
                <div class="ibox-content" style="background-color: #f3f6fb">
                    <div class="feed-activity-list">
                        {{ macros.feeds_widget(feeds, moment) }}
                    </div>
                </div>
            </div>
        </div>
    </div>


{% endblock %}

{% block scripts %}

    {{ super() }}

    <!-- Full Calendar -->
    <script src="{{ url_for('static', filename='js/plugins/fullcalendar/fullcalendar.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/fullcalendar/lang/it.js') }}"></script>

    <script>
        $(document).ready(function () {

            /* initialize the calendar
             -----------------------------------------------------------------*/
            var date = new Date();
            var d = date.getDate();
            var m = date.getMonth();
            var y = date.getFullYear();

            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                events: function (start, end, timezone, callback) {
                    $.ajax({
                        url: $SCRIPT_ROOT + '/api/users/{{ current_user.id }}/lessons/',
                        dataType: 'json',
                        success: function (data) {
                            callback(data.lessons);
                        }
                    })
                },
                editable: false,
                droppable: false
            });

        });

        /* initialize map
         -----------------------------------------------------------------*/
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 45.4375, lng: 12.335833},
                zoom: 12
            });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?callback=initMap" async defer></script>

{% endblock %}